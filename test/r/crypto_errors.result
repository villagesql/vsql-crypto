INSTALL EXTENSION vsql_crypto;
# Test digest with invalid algorithm (returns NULL)
SELECT digest('test', 'invalid-algo') IS NULL;
digest('test', 'invalid-algo') IS NULL
0
# Test digest with NULL data
SELECT digest(NULL, 'sha256') IS NULL;
digest(NULL, 'sha256') IS NULL
1
# Test digest with NULL algorithm
SELECT digest('test', NULL) IS NULL;
digest('test', NULL) IS NULL
1
# Test digest with empty algorithm (returns NULL)
SELECT digest('test', '') IS NULL;
digest('test', '') IS NULL
0
# Test hmac with invalid algorithm (returns NULL)
SELECT hmac('data', 'key', 'invalid-algo') IS NULL;
hmac('data', 'key', 'invalid-algo') IS NULL
0
# Test hmac with NULL data
SELECT hmac(NULL, 'key', 'sha256') IS NULL;
hmac(NULL, 'key', 'sha256') IS NULL
1
# Test hmac with NULL key
SELECT hmac('data', NULL, 'sha256') IS NULL;
hmac('data', NULL, 'sha256') IS NULL
1
# Test hmac with NULL algorithm
SELECT hmac('data', 'key', NULL) IS NULL;
hmac('data', 'key', NULL) IS NULL
1
# Test hmac with empty key (should work - HMAC allows empty keys)
SELECT LENGTH(hmac('data', '', 'sha256')) > 0;
LENGTH(hmac('data', '', 'sha256')) > 0
1
# Test encrypt with invalid algorithm (returns NULL)
SELECT encrypt('data', 'key', 'invalid-algo') IS NULL;
encrypt('data', 'key', 'invalid-algo') IS NULL
0
# Test encrypt with NULL data
SELECT encrypt(NULL, 'key', 'aes') IS NULL;
encrypt(NULL, 'key', 'aes') IS NULL
1
# Test encrypt with NULL key
SELECT encrypt('data', NULL, 'aes') IS NULL;
encrypt('data', NULL, 'aes') IS NULL
1
# Test encrypt with NULL algorithm
SELECT encrypt('data', 'key', NULL) IS NULL;
encrypt('data', 'key', NULL) IS NULL
1
# Test encrypt with empty key (returns NULL for security)
SELECT encrypt('data', '', 'aes') IS NULL;
encrypt('data', '', 'aes') IS NULL
0
# Test decrypt with invalid algorithm (returns NULL)
SELECT decrypt('data', 'key', 'invalid-algo') IS NULL;
decrypt('data', 'key', 'invalid-algo') IS NULL
0
# Test decrypt with NULL data
SELECT decrypt(NULL, 'key', 'aes') IS NULL;
decrypt(NULL, 'key', 'aes') IS NULL
1
# Test decrypt with NULL key
SELECT decrypt('data', NULL, 'aes') IS NULL;
decrypt('data', NULL, 'aes') IS NULL
1
# Test decrypt with NULL algorithm
SELECT decrypt('data', 'key', NULL) IS NULL;
decrypt('data', 'key', NULL) IS NULL
1
# Test decrypt with wrong key
SET @data = 'Hello, World!';
SET @key1 = 'correct-key-16!!';
SET @key2 = 'wrong-key-16!!!!';
SET @enc = encrypt(@data, @key1, 'aes');
SELECT decrypt(@enc, @key2, 'aes') = @data;
decrypt(@enc, @key2, 'aes') = @data
NULL
# Test decrypt with corrupted data
SELECT decrypt('corrupted-data', 'key', 'aes') IS NULL;
decrypt('corrupted-data', 'key', 'aes') IS NULL
0
# Test decrypt with too short data
SELECT decrypt('abc', 'key', 'aes') IS NULL;
decrypt('abc', 'key', 'aes') IS NULL
0
# Test gen_random_bytes with zero
SELECT gen_random_bytes(0) IS NULL;
gen_random_bytes(0) IS NULL
0
# Test gen_random_bytes with negative number
SELECT gen_random_bytes(-1) IS NULL;
gen_random_bytes(-1) IS NULL
0
# Test gen_random_bytes with very large number (should fail or return NULL)
SELECT gen_random_bytes(1073741824) IS NULL;
gen_random_bytes(1073741824) IS NULL
0
# Test gen_random_bytes with NULL
SELECT gen_random_bytes(NULL) IS NULL;
gen_random_bytes(NULL) IS NULL
1
# Test decrypt of data encrypted with different algorithm
SET @data = 'test data';
SET @key = 'sixteen-byte-key';
SET @enc_aes = encrypt(@data, @key, 'aes');
SELECT decrypt(@enc_aes, @key, 'aes-256') = @data;
decrypt(@enc_aes, @key, 'aes-256') = @data
1
# Test AES-256 requires longer key
SET @short_key = 'short';
SET @data = 'test';
SET @enc = encrypt(@data, @short_key, 'aes-256');
SELECT @enc IS NOT NULL;
@enc IS NOT NULL
1
# Test case sensitivity of algorithm names
SELECT HEX(digest('test', 'SHA256')) = HEX(digest('test', 'sha256'));
HEX(digest('test', 'SHA256')) = HEX(digest('test', 'sha256'))
1
# Test mixed case algorithm names
SELECT HEX(digest('test', 'Sha256'));
HEX(digest('test', 'Sha256'))
9F86D081884C7D659A2FEAA0C55AD015A3BF4F1B2B0B822CD15D6C15B0F00A08
# Test gen_salt with invalid algorithm
SELECT gen_salt('invalid-algo', 17) IS NULL;
gen_salt('invalid-algo', 17) IS NULL
0
# Test gen_salt with NULL
SELECT gen_salt(NULL, 100) IS NULL;
gen_salt(NULL, 100) IS NULL
1
# Test gen_salt with invalid iteration count (too small)
SELECT gen_salt('pbkdf2-sha256', 0) IS NULL;
gen_salt('pbkdf2-sha256', 0) IS NULL
0
# Test gen_salt with invalid iteration count (too large)
SELECT gen_salt('pbkdf2-sha256', 20000000) IS NULL;
gen_salt('pbkdf2-sha256', 20000000) IS NULL
0
# Test crypt with NULL password
SELECT crypt(NULL, '$pbkdf2-sha256$10000$abc') IS NULL;
crypt(NULL, '$pbkdf2-sha256$10000$abc') IS NULL
1
# Test crypt with NULL salt
SELECT crypt('password', NULL) IS NULL;
crypt('password', NULL) IS NULL
1
# Test crypt with invalid salt format
SELECT crypt('password', 'invalid-salt') IS NULL;
crypt('password', 'invalid-salt') IS NULL
0
# Test crypt with malformed salt (missing parts)
SELECT crypt('password', '$pbkdf2-sha256$10000') IS NULL;
crypt('password', '$pbkdf2-sha256$10000') IS NULL
0
# Test crypt with invalid algorithm in salt
SELECT crypt('password', '$invalid-algo$10000$abc') IS NULL;
crypt('password', '$invalid-algo$10000$abc') IS NULL
0
UNINSTALL EXTENSION vsql_crypto;
